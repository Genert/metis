window.MetisData=function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s="./src/index.ts")}({"./src/api.ts":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/utils.ts"),o=function(){function t(t){this._config=t}return t.prototype.submitEvents=function(t){var e=this;return new Promise(function(n,o){var r={method:e._config.method?e._config.method:"POST",host:e._config.host?e._config.host:"",query:e._config.query?e._config.query:{},body:t.getContent()},s=r.host+"?"+i.createQueryString(r.query);if(navigator.sendBeacon&&navigator.sendBeacon(s,r.body))return n();var u=new XMLHttpRequest;u.open(r.method,s,!0),u.withCredentials=!1,u.setRequestHeader("content-type","text/plain"),u.onreadystatechange=function(){if(4===u.readyState){var t=u.status;return 2===parseInt(String(t/100),10)?n():o(new Error("Request to "+s+' failed with status "'+t+'"'))}},u.send(r.body)})},t}();e.default=o},"./src/client.ts":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/event.ts"),o=n("./src/event-collection.ts"),r=n("./src/api.ts"),s=32768,u=2e3,c=function(){function t(t){this._config=t,this._stats={rejected:0,accepted:0,buffered:0,inflight:0,uploaded:0,dropped:0,evicted:0},this._flushingCollector=null,this._batchSize=this._config.batchSize?this._config.batchSize:s,this._bufferTime=this._config.bufferTime?this._config.bufferTime:u,this._eventsCollection=new o.default,this._api=new r.default(this._config.api),window.addEventListener("beforeunload",this.flushEventCollection.bind(this)),window.addEventListener("unload",this.flushEventCollection.bind(this)),document.addEventListener("visibilitychange",this.flushEventCollection.bind(this))}return t.prototype.addEvent=function(t){var e=this;return new Promise(function(n,o){var r=null;try{r=new i.default(t)}catch(t){return e._stats.rejected++,o(t)}if(r.getSize()>e._batchSize)return o(new Error('Event "'+t.name+'" size "'+r.getSize()+'" is larger than allowed batch size '+e._batchSize));e._stats.accepted++,e._eventsCollection.getSizeWith(r)>e._batchSize&&e.flushEventCollection(),e._eventsCollection.add(r),e._stats.buffered++,e._eventsCollection.getSize()>=e._batchSize?e.flushEventCollection():null===e._flushingCollector&&e._bufferTime!==1/0&&(e._flushingCollector=setTimeout(e.flushEventCollection.bind(e),e._bufferTime)),n()})},t.prototype.flushEventCollection=function(){this.clearFlushingCollector(),0!==this._eventsCollection.getEventsCount()&&(this._stats.buffered-=this._eventsCollection.getEventsCount(),this._stats.inflight+=this._eventsCollection.getEventsCount(),this._api.submitEvents(this._eventsCollection).then(function(){}),this._eventsCollection.reset())},t.prototype.reset=function(){this._stats.buffered-=this._eventsCollection.getEventsCount(),this._stats.evicted+=this._eventsCollection.getEventsCount(),this._eventsCollection.reset(),this.clearFlushingCollector()},t.prototype.getStats=function(){return this._stats},t.prototype.clearFlushingCollector=function(){clearTimeout(this._flushingCollector),this._flushingCollector=null},t}();e.default=c},"./src/event-collection.ts":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){void 0===t&&(t=[]),void 0===e&&(e=0),this._events=t,this._size=e}return t.prototype.add=function(t){this._events.push(t),this._size+=t.getSize()},t.prototype.getContent=function(){var t=this._events.reduce(function(t,e){return t.push(e.getEvent()),t},[]);return JSON.stringify(t)},t.prototype.reset=function(){this._events=[],this._size=0},t.prototype.getEvents=function(){return this._events},t.prototype.getEventsCount=function(){return this._events.length},t.prototype.getSize=function(){return this._size},t.prototype.getSizeWith=function(t){return this.getSize()+t.getSize()},t}();e.default=i},"./src/event.ts":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/utils.ts"),o=function(){function t(t){this._eventConfiguration=t;var e=t.name;if("string"!=typeof e)throw new Error('Invalid name, expected a string. Current value "'+String(e));var n=this._eventConfiguration.id?this._eventConfiguration.id:i.generateUUIDV4(),o=this._eventConfiguration.timestamp?this._eventConfiguration.timestamp:Date.now(),r=this._eventConfiguration.data?this._eventConfiguration.data:{};if("number"!=typeof o)throw new Error('Invalid time, expected an integer. Current value "'+String(o)+'"');try{Object.getPrototypeOf(r)}catch(t){throw new Error('Invalid data, expected object. Got "'+typeof r+'" instead')}this._content={id:n,name:e,timestamp:o,data:r}}return t.prototype.getEvent=function(){return this._content},t.prototype.getSize=function(){return this.toString().length},t.prototype.toString=function(){return JSON.stringify(this._content)},t}();e.default=o},"./src/index.ts":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("./src/client.ts"),o=function(){function t(t){if(this._config=t,!this._config)throw new Error("Please provide configuration");this._client=new i.default(this._config)}return t.prototype.addEvent=function(t){return this._client.addEvent(t)},t.prototype.reset=function(){this._client.reset()},t.prototype.getStats=function(){return this._client.getStats()},t}();e.default=o},"./src/utils.ts":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.generateUUIDV4=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(t){return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)})},e.createQueryString=function(t){void 0===t&&(t={});var e=Object.keys(t);return 0===e.length?"":e.reduce(function(e,n){return e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n])),e},[]).join("&")}}});